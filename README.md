# 1. ä»‹ç»

æœ¬é¡¹ç›®ç”¨äºæ ¹æ®é…ç½®è§„åˆ™æ¥è‡ªåŠ¨ç”Ÿæˆ Clash é…ç½®æ–‡ä»¶ï¼ŒåŒæ—¶æ”¯æŒå°†é…ç½®æ–‡ä»¶ä¸Šä¼ åˆ° gist ä½œä¸ºè®¢é˜…é“¾æ¥ä½¿ç”¨ã€‚

è§„åˆ™ç‰‡æ®µæ¥è‡ª [ACL4SSR](https://github.com/ACL4SSR/ACL4SSR)ï¼Œåˆ›å»ºäº†å¸¸ç”¨çš„è®¢é˜…åˆ†ç»„ï¼Œå¦‚ä¸‹ï¼š

![](https://s2.loli.net/2023/07/20/gfaL5VpHUEWNnbB.png)

> é¡¹ç›®çµæ„Ÿæ¥è‡ª [subconvert](https://github.com/tindy2013/subconverter)ï¼Œç”±äº subconvert ä¸æ”¯æŒ vless è®¢é˜…è€Œæ”¾å¼ƒä½¿ç”¨ï¼Œä½†æ˜¯æœ¬é¡¹ç›®**åªå…³æ³¨ Clash é…ç½®æ–‡ä»¶**çš„ç”Ÿæˆï¼ˆæ˜¯ä¸€ä¸ªéå¸¸è…Šé¸¡çš„è„šæœ¬ï¼‰ï¼Œæ²¡æœ‰ subconvert é‚£ä¹ˆå¼ºå¤§çš„è®¢é˜…è§„åˆ™äº’ç›¸è½¬æ¢åŠŸèƒ½ã€‚

# 2. ä½¿ç”¨æ–¹å¼

é¦–å…ˆï¼ˆç»™æœ¬é¡¹ç›®ä¸€ä¸ª star ğŸ˜˜ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ä»£ç åº“å¹¶å¯¼å…¥æœ¬é¡¹ç›®çš„ä»£ç ï¼Œæ¨èç›´æ¥ä½¿ç”¨ Github çš„ä»“åº“å¯¼å…¥åŠŸèƒ½ï¼š

![](https://s2.loli.net/2023/07/20/afd62g574rnqoh1.png)

> ä»“åº“æºè¾“å…¥ï¼šhttps://github.com/EsunR/clash-sub-builder.git

**è®°å¾—æŠŠä»“åº“è®¾ç½®ä¸º private**ï¼Œä½ ä¹Ÿä¸æƒ³è®©ä½ çš„èŠ‚ç‚¹ä¿¡æ¯æš´éœ²ç»™åˆ«äººå§ï¼Œç„¶åæŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤æ‰§è¡Œã€‚

## 2.1 å¡«å†™èŠ‚ç‚¹ä¿¡æ¯

> å¦‚æœä½ ä¹‹å‰ä½¿ç”¨çš„æ˜¯æœºåœºè®¢é˜…ï¼Œå¯ä»¥ç›´æ¥ç”¨æµè§ˆå™¨æ‰“å¼€æœºçš„è®¢é˜…é“¾æ¥ï¼Œå¤åˆ¶é¡µé¢ä¸Šçš„å†…å®¹ï¼Œè¦†ç›–æ‰ `/config/template.yml` ä¸­çš„å†…å®¹å³å¯ï¼Œç„¶åè·³è¿‡è¿™ä¸€èŠ‚

ç¼–è¾‘ `/config/template.yml` çš„ Clash è®¢é˜…æ¨¡æ¿ï¼Œå°†ä½ çš„èŠ‚ç‚¹ä¿¡æ¯å†™å…¥åˆ° proxies é‡Œï¼Œä½ ä¹Ÿå¯ä»¥åœ¨æ­¤æ·»åŠ å…¶ä»–é…ç½®ï¼Œæ·»åŠ äº†èŠ‚ç‚¹ä¿¡æ¯çš„æ¨¡æ¿ç¤ºä¾‹å¦‚ä¸‹ï¼š

```yml
mixed-port: 7890
allow-lan: true
mode: Rule
log-level: info
external-controller: :9090
proxies:
  - name: Demo VPS 1
    server: www.example.com
    port: 443
    type: vmess
    uuid: xxx-xxx-xxx-xxx
    alterId: 0
    cipher: auto
    tls: true
    skip-cert-verify: true
    network: ws
    ws-opts:
      path: /download
    udp: true
proxy-groups:
rules:
```

å¦‚æœä½ éœ€è¦åˆ›å»ºå¤šå¥—æ¨¡æ¿ï¼Œå¯ä»¥åœ¨ `/config` ç›®å½•ä¸‹åˆ›å»ºå¤šä¸ªä»¥ `template` ä¸ºå¼€å¤´çš„æ¨¡æ¿æ–‡ä»¶ï¼Œå¦‚ `template_reality.yml`ã€`template_hysteria2.yml`ï¼Œè„šæœ¬ä¼šå°†å…¶å…¨éƒ¨è¯»å–å¹¶è½¬æ¢ä¸ºå¤šä¸ªè®¢é˜…é“¾æ¥ã€‚

å¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•ç¼–å†™ Clash è®¢é˜…èŠ‚ç‚¹çš„é…ç½®ï¼Œå¯ä»¥å‚è€ƒï¼š

- [Clash èŠ‚ç‚¹é…ç½®å®˜æ–¹æ–‡æ¡£](https://dreamacro.github.io/clash/zh_CN/configuration/outbound.html#outbound-%E5%87%BA%E7%AB%99)
- [Clash.meta èŠ‚ç‚¹é…ç½®å®˜æ–¹æ–‡æ¡£](https://wiki.metacubex.one/config/proxies/)

## 2.2 ä¸Šä¼ é…ç½®åˆ° gist ç”Ÿæˆè®¢é˜…é“¾æ¥

### è·å– Github Token

é¦–å…ˆï¼Œè®¿é—® https://github.com/settings/tokens æ¥ç”Ÿæˆä¸€ä¸ª gist çš„æˆæƒ Tokenï¼š

![](https://s2.loli.net/2023/07/20/7oyEtOhRDs2IVMW.png)

å‹¾é€‰æ— è¿‡æœŸé™åˆ¶ï¼š

![](https://s2.loli.net/2023/07/20/6S1IQc859PgErUp.png)

åªå‹¾é€‰ gist æƒé™ï¼š

![](https://s2.loli.net/2023/07/20/j3oMdmZpH1v895f.png)

ç„¶åå¤åˆ¶ç”Ÿæˆçš„ä»¥ `ghp_` å¼€å¤´çš„ tokenï¼š

![](https://s2.loli.net/2023/07/20/rkV7eFsNigbhJnZ.png)

### è·å– gist id

æƒ³è¦æŠŠç”Ÿæˆçš„ Clash è®¢é˜…æ¨é€åˆ° gist ä¸Šï¼Œå°±éœ€è¦ç°åœ¨ gist ä¸Šåˆ›å»ºä¸€ä¸ª gist é¡¹ç›®ã€‚

è®¿é—® https://gist.github.com/ ç„¶ååˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®:

![](https://s2.loli.net/2023/07/20/X9wApBqcJGI8Ubo.png)

åˆ›å»ºå®Œæˆåï¼Œå¤åˆ¶æµè§ˆå™¨ä¸­çš„è¿™æ®µè·¯å¾„ï¼Œå³ä¸º gist idï¼š

![](https://s2.loli.net/2023/07/20/5RvPw6ytDbGZQud.png)

### å®Œå–„ä¿¡æ¯

ç»è¿‡ä¸Šé¢ä¸¤ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å·²ç»æ‹¿åˆ°äº† github token å’Œ gist idï¼Œæ‰“å¼€ `/config/gist.toml` å®Œå–„é…ç½®æ–‡ä»¶ï¼š

```
[[common]]
token = è¿™é‡Œè¾“å…¥ github token
id = è¿™é‡Œè¾“å…¥ gist id
```

> å¦‚æœä½ ä¸æƒ³æ˜æ–‡å†™åœ¨é…ç½®æ–‡ä»¶é‡Œï¼Œå¯ä»¥ä½¿ç”¨åœ¨ Github Action ä¸­åˆ›å»ºç¯å¢ƒå˜é‡ï¼Œå…¶å¯¹åº”çš„ç¯å¢ƒå˜é‡åˆ†åˆ«ä¸º `GIST_TOKEN`ã€`GIST_ID`ã€‚

### æ¨é€ä»£ç åˆ° Github ä¸Šå¹¶è·å–è®¢é˜…é“¾æ¥

æäº¤åˆ°ä»£ç å˜æ›´åˆ°ä½ çš„ä»“åº“ä¸­ï¼Œç„¶åå°±ä¼šè§¦å‘ Github Action è‡ªåŠ¨ç”Ÿæˆ Clash è®¢é˜…ï¼Œå¹¶å‘å¸ƒé…ç½®æ–‡ä»¶åˆ° gist ä¸Šï¼Œä½ å¯ä»¥åœ¨ Github Action çš„è¾“å‡ºæ—¥å¿—ä¸­æŸ¥çœ‹è®¢é˜…åœ°å€ï¼š

![](https://s2.loli.net/2023/07/20/NUFls8kxbwY2G3W.png)

![](https://s2.loli.net/2023/07/20/GcOmD8WTa5PwKJQ.png)

![](https://s2.loli.net/2023/07/20/ZrjoPt4BwbWSaX1.png)

åç»­æ¯æ¬¡æ›´æ–°èŠ‚ç‚¹é…ç½®æˆ–è€…è§„åˆ™ï¼Œæäº¤ä»£ç å Github Action å°±ä¼šè‡ªåŠ¨å¸®ä½ æ›´æ–°é…ç½®ï¼

> PS: Gist æ— æ³•åœ¨ä¸­å›½å¤§é™†æ­£å¸¸è®¿é—®ï¼Œä½ å¯ä»¥ä½¿ç”¨ Vercel æˆ–è€… Cloudflare æ¥æ­å»ºä¸€ä¸ªå»ºè®®çš„ä»£ç†æœåŠ¡ä»£ç†åˆ°ä½ çš„è®¢é˜…é“¾æ¥ä¸Š

# 3. å˜æ›´é…ç½®

å¦‚æœä½ ä¸æ»¡è¶³é¢„è®¾çš„é…ç½®ï¼Œä½ å¯ä»¥åœ¨ `config/groups.toml` ä¸­ä¿®æ”¹æˆ–æ–°å¢é…ç½®ç»„ï¼Œè¿˜å¯ä»¥åœ¨ `config/rulesets.toml` ä¸­ä¿®æ”¹æ¯ä¸ªé…ç½®ç»„çš„è§„åˆ™ã€‚

å¦‚æœä½ åªæƒ³ç®€å•çš„è¡¥å……è§„åˆ™ï¼Œå¯ä»¥åœ¨ `rules/custom/Direct.list` æ·»åŠ èµ°ç›´è¿è§„åˆ™ï¼Œåœ¨ `rules/custom/Global.list` ä¸­æ·»åŠ èµ°ä»£ç†çš„è§„åˆ™ã€‚è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„è§„åˆ™ä¼˜å…ˆçº§ä¼šè¢«è®¾ç½®ä¸ºæœ€é«˜ã€‚

# 4. æœ¬åœ°è¿è¡Œ

å¦‚æœä½ ä¸æƒ³åœ¨ Github Action ä¸­æ‰§è¡Œå‘å¸ƒï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åœ¨æœ¬åœ°è¿è¡Œã€‚

é¦–å…ˆå‡†å¤‡å¥½ node ç¯å¢ƒï¼ˆv18ï¼‰ï¼Œç„¶åå®‰è£…é¡¹ç›®ä¾èµ–ï¼š

```sh
npm install
```

å¦‚æœåªæƒ³ç”Ÿæˆ Clash é…ç½®æ–‡ä»¶ï¼Œè€Œä¸æƒ³ä¸Šä¼ åˆ° gistï¼Œå¯ä»¥æ‰§è¡Œï¼š

```sh
npm run dev
```

ç”Ÿæˆçš„é…ç½®æ–‡ä»¶å¯ä»¥åœ¨æ ¹ç›®å½•æ‰¾åˆ°ï¼ˆsubscribe.ymlï¼‰ã€‚

å¦‚æœéœ€è¦ä¸Šä¼ åˆ° gistï¼Œåˆ™æ‰§è¡Œï¼š

```
npm run start
```

# 5. åŒæ­¥æœ¬ä»“åº“çš„æ›´æ–°

> æ³¨æ„ï¼šéœ€è¦æŒæ¡ä¸€å®šçš„ git ç›¸å…³çŸ¥è¯†ï¼Œå¦åˆ™è¯·æ‰‹åŠ¨è¦†ç›–ä»£ç è¿›è¡Œæ›´æ–°

é™æœ¬é¡¹ç›®çš„ git æºè®¾ç½®ä¸º upstreamï¼š

```sh
git remote add upstream https://github.com/EsunR/clash-sub-builder.git
```

ä» upstream æ‹‰å–æœ€æ–°ä»£ç ï¼š

```sh
git fetch upstream
git merge upstream/main
```
